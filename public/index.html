<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster Pro - Gerenciador de Tarefas</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pending { color: #f56565; }
        .completed { color: #48bb78; }
        .total { color: #4299e1; }
        .users { color: #9f7aea; }

        /* Filters Section */
        .filters-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters-title {
            font-size: 1.5rem;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .clear-filters {
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .clear-filters:hover {
            background: #cbd5e0;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 20px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .active-filters {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-tag .remove {
            cursor: pointer;
            font-weight: bold;
            margin-left: 5px;
        }

        .results-info {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-count {
            font-weight: 600;
        }

        .sort-options {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .sort-btn {
            background: none;
            border: 1px solid #e2e8f0;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .sort-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .sort-btn:hover {
            border-color: #667eea;
        }

        .tasks-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.8rem;
            color: #4a5568;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .tasks-grid {
            display: grid;
            gap: 20px;
        }

        .task-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #e2e8f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .task-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .task-card.urgent { border-left-color: #f56565; }
        .task-card.high { border-left-color: #ed8936; }
        .task-card.medium { border-left-color: #4299e1; }
        .task-card.low { border-left-color: #48bb78; }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .task-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pendente {
            background: #fed7d7;
            color: #c53030;
        }

        .status-concluida {
            background: #c6f6d5;
            color: #2f855a;
        }

        .status-em-progresso {
            background: #bee3f8;
            color: #2b6cb0;
        }

        .task-description {
            color: #718096;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #a0aec0;
        }

        .priority-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-urgente {
            background: #fed7d7;
            color: #c53030;
        }

        .priority-alta {
            background: #feebc8;
            color: #c05621;
        }

        .priority-media {
            background: #bee3f8;
            color: #2b6cb0;
        }

        .priority-baixa {
            background: #c6f6d5;
            color: #2f855a;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .no-results i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Action Buttons */
        .task-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .task-card:hover .task-actions {
            opacity: 1;
        }

        .action-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .action-btn.edit {
            background: #bee3f8;
            color: #2b6cb0;
        }

        .action-btn.edit:hover {
            background: #90cdf4;
            transform: scale(1.1);
        }

        .action-btn.complete {
            background: #c6f6d5;
            color: #2f855a;
        }

        .action-btn.complete:hover {
            background: #9ae6b4;
            transform: scale(1.1);
        }

        .action-btn.undo {
            background: #feebc8;
            color: #c05621;
        }

        .action-btn.undo:hover {
            background: #fbd38d;
            transform: scale(1.1);
        }

        .action-btn.delete {
            background: #fed7d7;
            color: #c53030;
        }

        .action-btn.delete:hover {
            background: #feb2b2;
            transform: scale(1.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: #4a5568;
            font-size: 1.5rem;
            margin: 0;
        }

        .close {
            color: #a0aec0;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #f56565;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            padding: 25px 30px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        form {
            padding: 30px;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            animation: slideInRight 0.3s ease;
        }

        .notification.success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .filters-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .filters-header {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .results-info {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-tasks"></i> TaskMaster Pro</h1>
            <p>Sistema Profissional de Gerenciamento de Tarefas</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon pending">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-number" id="pendingCount">-</div>
                <div class="stat-label">Pendentes</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon completed">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-number" id="completedCount">-</div>
                <div class="stat-label">Concluídas</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-list"></i>
                </div>
                <div class="stat-number" id="totalCount">-</div>
                <div class="stat-label">Total</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon users">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="usersCount">-</div>
                <div class="stat-label">Usuários</div>
            </div>
        </div>
                <!-- Filters Section -->
        <div class="filters-section">
            <div class="filters-header">
                <h3 class="filters-title">
                    <i class="fas fa-filter"></i> Filtros e Busca
                </h3>
                <button class="clear-filters" onclick="clearAllFilters()">
                    <i class="fas fa-times"></i> Limpar Filtros
                </button>
            </div>
            
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-search"></i> Buscar Tarefas
                    </label>
                    <input type="text" id="searchInput" class="search-input" 
                           placeholder="Digite para buscar por título ou descrição..." 
                           oninput="applyFilters()">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-flag"></i> Status
                    </label>
                    <select id="statusFilter" class="filter-select" onchange="applyFilters()">
                        <option value="">Todos os Status</option>
                        <option value="pendente">⏳ Pendente</option>
                        <option value="em_progresso">🔄 Em Progresso</option>
                        <option value="concluida">✅ Concluída</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-exclamation"></i> Prioridade
                    </label>
                    <select id="priorityFilter" class="filter-select" onchange="applyFilters()">
                        <option value="">Todas as Prioridades</option>
                        <option value="urgente">🔴 Urgente</option>
                        <option value="alta">🟠 Alta</option>
                        <option value="media">🟡 Média</option>
                        <option value="baixa">🟢 Baixa</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-calendar"></i> Data
                    </label>
                    <select id="dateFilter" class="filter-select" onchange="applyFilters()">
                        <option value="">Todas as Datas</option>
                        <option value="hoje">📅 Hoje</option>
                        <option value="semana">📅 Esta Semana</option>
                        <option value="mes">📅 Este Mês</option>
                        <option value="atrasadas">⚠️ Atrasadas</option>
                        <option value="sem_prazo">∞ Sem Prazo</option>
                    </select>
                </div>
            </div>
            
            <div class="active-filters" id="activeFilters"></div>
        </div>

        <!-- Tasks Section -->
        <div class="tasks-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-clipboard-list"></i> Minhas Tarefas
                </h2>
                <div style="display: flex; gap: 15px;">
                    <button class="btn" onclick="openModal()">
                        <i class="fas fa-plus"></i> Nova Tarefa
                    </button>
                    <button class="btn-secondary" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                </div>
            </div>
            
            <!-- Results Info -->
            <div class="results-info" id="resultsInfo" style="display: none;">
                <div class="results-count" id="resultsCount"></div>
                <div class="sort-options">
                    <span style="font-size: 0.9rem; margin-right: 10px;">Ordenar por:</span>
                    <button class="sort-btn active" onclick="sortTasks('created_at')" data-sort="created_at">
                        <i class="fas fa-clock"></i> Data
                    </button>
                    <button class="sort-btn" onclick="sortTasks('priority')" data-sort="priority">
                        <i class="fas fa-exclamation"></i> Prioridade
                    </button>
                    <button class="sort-btn" onclick="sortTasks('title')" data-sort="title">
                        <i class="fas fa-sort-alpha-down"></i> Título
                    </button>
                </div>
            </div>
            
            <div id="tasksContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Carregando tarefas...
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nova Tarefa -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Nova Tarefa</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            
            <form id="taskForm" onsubmit="createTask(event)">
                <div class="form-group">
                    <label for="taskTitle">Título da Tarefa</label>
                    <input type="text" id="taskTitle" required placeholder="Digite o título da tarefa">
                </div>
                
                <div class="form-group">
                    <label for="taskDescription">Descrição</label>
                    <textarea id="taskDescription" rows="3" placeholder="Descreva os detalhes da tarefa"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskPriority">Prioridade</label>
                        <select id="taskPriority" required>
                            <option value="baixa">🟢 Baixa</option>
                            <option value="media" selected>🟡 Média</option>
                            <option value="alta">🟠 Alta</option>
                            <option value="urgente">🔴 Urgente</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskDueDate">Data Limite</label>
                        <input type="date" id="taskDueDate">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Criar Tarefa
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Editar Tarefa -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Editar Tarefa</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            
            <form id="editTaskForm" onsubmit="updateTask(event)">
                <input type="hidden" id="editTaskId">
                
                <div class="form-group">
                    <label for="editTaskTitle">Título da Tarefa</label>
                    <input type="text" id="editTaskTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="editTaskDescription">Descrição</label>
                    <textarea id="editTaskDescription" rows="3"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editTaskPriority">Prioridade</label>
                        <select id="editTaskPriority" required>
                            <option value="baixa">🟢 Baixa</option>
                            <option value="media">🟡 Média</option>
                            <option value="alta">🟠 Alta</option>
                            <option value="urgente">🔴 Urgente</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editTaskStatus">Status</label>
                        <select id="editTaskStatus" required>
                            <option value="pendente">⏳ Pendente</option>
                            <option value="em_progresso">🔄 Em Progresso</option>
                            <option value="concluida">✅ Concluída</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editTaskDueDate">Data Limite</label>
                    <input type="date" id="editTaskDueDate">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle" style="color: #f56565;"></i> Confirmar Exclusão</h3>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>
            
            <div style="padding: 30px; text-align: center;">
                <p style="margin-bottom: 20px; color: #4a5568; font-size: 1.1rem;">
                    Tem certeza que deseja excluir esta tarefa?
                </p>
                <p style="margin-bottom: 30px; color: #718096;">
                    <strong id="deleteTaskTitle"></strong>
                </p>
                <p style="color: #e53e3e; font-size: 0.9rem; margin-bottom: 30px;">
                    ⚠️ Esta ação não pode ser desfeita!
                </p>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeDeleteModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn" style="background: linear-gradient(135deg, #f56565, #e53e3e);" onclick="confirmDelete()">
                        <i class="fas fa-trash"></i> Sim, Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>
        <script>
        // Variáveis globais
        let allTasks = [];
        let filteredTasks = [];
        let taskToDelete = null;
        let currentSort = 'created_at';

        // Função para carregar dados
        async function loadData() {
            try {
                const tasksResponse = await fetch('/api/tasks');
                const tasksData = await tasksResponse.json();
                
                const usersResponse = await fetch('/api/users');
                const usersData = await usersResponse.json();
                
                if (tasksData.success) {
                    allTasks = tasksData.tasks;
                    filteredTasks = [...allTasks];
                    applyFilters();
                    updateStats(allTasks, usersData.users || []);
                } else {
                    showError('Erro ao carregar tarefas: ' + tasksData.message);
                }
            } catch (error) {
                showError('Erro de conexão: ' + error.message);
            }
        }

        // Função para aplicar filtros
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            filteredTasks = allTasks.filter(task => {
                const matchesSearch = !searchTerm || 
                    task.title.toLowerCase().includes(searchTerm) || 
                    (task.description && task.description.toLowerCase().includes(searchTerm));
                
                const matchesStatus = !statusFilter || task.status === statusFilter;
                const matchesPriority = !priorityFilter || task.priority === priorityFilter;
                const matchesDate = checkDateFilter(task, dateFilter);
                
                return matchesSearch && matchesStatus && matchesPriority && matchesDate;
            });
            
            sortTasks(currentSort);
            displayTasks(filteredTasks);
            updateResultsInfo();
            updateActiveFilters();
        }

        // Função para verificar filtro de data
        function checkDateFilter(task, dateFilter) {
            if (!dateFilter) return true;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const taskDate = task.due_date ? new Date(task.due_date) : null;
            
            switch (dateFilter) {
                case 'hoje':
                    if (!taskDate) return false;
                    const taskDateOnly = new Date(taskDate);
                    taskDateOnly.setHours(0, 0, 0, 0);
                    return taskDateOnly.getTime() === today.getTime();
                
                case 'semana':
                    if (!taskDate) return false;
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    return taskDate >= weekStart && taskDate <= weekEnd;
                
                case 'mes':
                    if (!taskDate) return false;
                    return taskDate.getMonth() === today.getMonth() && 
                           taskDate.getFullYear() === today.getFullYear();
                
                case 'atrasadas':
                    if (!taskDate) return false;
                    return taskDate < today && task.status !== 'concluida';
                
                case 'sem_prazo':
                    return !taskDate;
                
                default:
                    return true;
            }
        }

        // Função para ordenar tarefas
        function sortTasks(sortBy) {
            currentSort = sortBy;
            
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-sort="${sortBy}"]`).classList.add('active');
            
            filteredTasks.sort((a, b) => {
                switch (sortBy) {
                    case 'created_at':
                        return new Date(b.created_at) - new Date(a.created_at);
                    
                    case 'priority':
                        const priorityOrder = { 'urgente': 4, 'alta': 3, 'media': 2, 'baixa': 1 };
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    
                    case 'title':
                        return a.title.localeCompare(b.title);
                    
                    default:
                        return 0;
                }
            });
            
            displayTasks(filteredTasks);
        }

        // Função para limpar todos os filtros
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('dateFilter').value = '';
            
            applyFilters();
        }

        // Função para atualizar informações dos resultados
        function updateResultsInfo() {
            const resultsInfo = document.getElementById('resultsInfo');
            const resultsCount = document.getElementById('resultsCount');
            
            if (filteredTasks.length === allTasks.length) {
                resultsInfo.style.display = 'none';
            } else {
                resultsInfo.style.display = 'flex';
                resultsCount.innerHTML = `
                    <i class="fas fa-filter"></i> 
                    Mostrando ${filteredTasks.length} de ${allTasks.length} tarefas
                `;
            }
        }

        // Função para atualizar filtros ativos
        function updateActiveFilters() {
            const activeFiltersContainer = document.getElementById('activeFilters');
            const filters = [];
            
            const searchTerm = document.getElementById('searchInput').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            if (searchTerm) {
                filters.push({ type: 'search', value: searchTerm, label: `Busca: "${searchTerm}"` });
            }
            
            if (statusFilter) {
                const statusLabels = {
                    'pendente': 'Status: Pendente',
                    'em_progresso': 'Status: Em Progresso',
                    'concluida': 'Status: Concluída'
                };
                filters.push({ type: 'status', value: statusFilter, label: statusLabels[statusFilter] });
            }
            
            if (priorityFilter) {
                const priorityLabels = {
                    'urgente': 'Prioridade: Urgente',
                    'alta': 'Prioridade: Alta',
                    'media': 'Prioridade: Média',
                    'baixa': 'Prioridade: Baixa'
                };
                filters.push({ type: 'priority', value: priorityFilter, label: priorityLabels[priorityFilter] });
            }
            
            if (dateFilter) {
                const dateLabels = {
                    'hoje': 'Data: Hoje',
                    'semana': 'Data: Esta Semana',
                    'mes': 'Data: Este Mês',
                    'atrasadas': 'Data: Atrasadas',
                    'sem_prazo': 'Data: Sem Prazo'
                };
                filters.push({ type: 'date', value: dateFilter, label: dateLabels[dateFilter] });
            }
            
            if (filters.length === 0) {
                activeFiltersContainer.innerHTML = '';
                return;
            }
            
            activeFiltersContainer.innerHTML = filters.map(filter => `
                <div class="filter-tag">
                    ${filter.label}
                    <span class="remove" onclick="removeFilter('${filter.type}')">&times;</span>
                </div>
            `).join('');
        }

        // Função para remover filtro específico
        function removeFilter(filterType) {
            switch (filterType) {
                case 'search':
                    document.getElementById('searchInput').value = '';
                    break;
                case 'status':
                    document.getElementById('statusFilter').value = '';
                    break;
                case 'priority':
                    document.getElementById('priorityFilter').value = '';
                    break;
                case 'date':
                    document.getElementById('dateFilter').value = '';
                    break;
            }
            
            applyFilters();
        }

        // Função para exibir tarefas
        function displayTasks(tasks) {
            const container = document.getElementById('tasksContainer');
            
            if (tasks.length === 0) {
                const isFiltered = document.getElementById('searchInput').value ||
                                 document.getElementById('statusFilter').value ||
                                 document.getElementById('priorityFilter').value ||
                                 document.getElementById('dateFilter').value;
                
                if (isFiltered) {
                    container.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-search"></i>
                            <h3>Nenhuma tarefa encontrada</h3>
                            <p>Tente ajustar os filtros ou criar uma nova tarefa</p>
                            <br>
                            <button class="btn-secondary" onclick="clearAllFilters()">
                                <i class="fas fa-times"></i> Limpar Filtros
                            </button>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="loading">
                            <i class="fas fa-inbox"></i> Nenhuma tarefa encontrada
                            <br><br>
                            <button class="btn" onclick="openModal()">
                                <i class="fas fa-plus"></i> Criar sua primeira tarefa
                            </button>
                        </div>
                    `;
                }
                return;
            }

            const tasksHTML = tasks.map(task => {
                const priorityClass = `priority-${task.priority}`;
                const statusClass = `status-${task.status}`;
                const cardClass = getPriorityCardClass(task.priority);
                const dueDate = task.due_date ? new Date(task.due_date).toLocaleDateString('pt-BR') : 'Sem prazo';
                
                return `
                    <div class="task-card ${cardClass}">
                        <div class="task-header">
                            <div>
                                <div class="task-title">${task.title}</div>
                                <span class="task-status ${statusClass}">
                                    ${getStatusText(task.status)}
                                </span>
                            </div>
                            <div class="task-actions">
                                <button class="action-btn edit" onclick="editTask('${task.id}')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn ${task.status === 'concluida' ? 'undo' : 'complete'}" 
                                        onclick="toggleTaskStatus('${task.id}', '${task.status}')" 
                                        title="${task.status === 'concluida' ? 'Marcar como Pendente' : 'Marcar como Concluída'}">
                                    <i class="fas ${task.status === 'concluida' ? 'fa-undo' : 'fa-check'}"></i>
                                </button>
                                <button class="action-btn delete" onclick="deleteTask('${task.id}')" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="task-description">
                            ${task.description || 'Sem descrição'}
                        </div>
                        
                        <div class="task-meta">
                            <div>
                                <span class="priority-badge ${priorityClass}">
                                    ${getPriorityText(task.priority)}
                                </span>
                            </div>
                            <div>
                                <i class="fas fa-calendar"></i> ${dueDate}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `<div class="tasks-grid">${tasksHTML}</div>`;
        }

        // Função para atualizar estatísticas
        function updateStats(tasks, users) {
            const pending = tasks.filter(t => t.status === 'pendente').length;
            const completed = tasks.filter(t => t.status === 'concluida').length;
            const total = tasks.length;
            const usersCount = users.length;

            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('usersCount').textContent = usersCount;
        }

        // Funções auxiliares
        function getPriorityCardClass(priority) {
            const classes = {
                'urgente': 'urgent',
                'alta': 'high',
                'media': 'medium',
                'baixa': 'low'
            };
            return classes[priority] || 'medium';
        }

        function getStatusText(status) {
            const texts = {
                'pendente': 'Pendente',
                'em_progresso': 'Em Progresso',
                'concluida': 'Concluída'
            };
            return texts[status] || status;
        }

        function getPriorityText(priority) {
            const texts = {
                'urgente': 'Urgente',
                'alta': 'Alta',
                'media': 'Média',
                'baixa': 'Baixa'
            };
            return texts[priority] || priority;
        }

        function showError(message) {
            const container = document.getElementById('tasksContainer');
            container.innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i> ${message}</div>`;
        }

        function refreshData() {
            document.getElementById('tasksContainer').innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Atualizando...
                </div>
            `;
            loadData();
        }

        // Funções do Modal
        function openModal() {
            document.getElementById('taskModal').style.display = 'block';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskDueDate').min = today;
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
            document.getElementById('taskForm').reset();
        }

        // Função para editar tarefa
        async function editTask(taskId) {
            try {
                const response = await fetch(`/api/tasks/${taskId}`);
                const result = await response.json();
                
                if (result.success) {
                    const task = result.task;
                    
                    document.getElementById('editTaskId').value = task.id;
                    document.getElementById('editTaskTitle').value = task.title;
                    document.getElementById('editTaskDescription').value = task.description || '';
                    document.getElementById('editTaskPriority').value = task.priority;
                    document.getElementById('editTaskStatus').value = task.status;
                    
                    if (task.due_date) {
                        const dueDate = new Date(task.due_date).toISOString().split('T')[0];
                        document.getElementById('editTaskDueDate').value = dueDate;
                    }
                    
                    document.getElementById('editTaskModal').style.display = 'block';
                } else {
                    showError('Erro ao carregar tarefa: ' + result.message);
                }
            } catch (error) {
                showError('Erro de conexão: ' + error.message);
            }
        }

        // Função para atualizar tarefa
        async function updateTask(event) {
            event.preventDefault();
            
            const taskId = document.getElementById('editTaskId').value;
            const title = document.getElementById('editTaskTitle').value;
            const description = document.getElementById('editTaskDescription').value;
            const priority = document.getElementById('editTaskPriority').value;
            const status = document.getElementById('editTaskStatus').value;
            const dueDate = document.getElementById('editTaskDueDate').value;
            
            const taskData = {
                title,
                description,
                priority,
                status,
                due_date: dueDate ? new Date(dueDate).toISOString() : null
            };
            
            try {
                const response = await fetch(`/api/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(taskData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    closeEditModal();
                    refreshData();
                    showSuccess('Tarefa atualizada com sucesso!');
                } else {
                    showError('Erro ao atualizar tarefa: ' + result.message);
                }
            } catch (error) {
                showError('Erro de conexão: ' + error.message);
            }
        }

        // Função para alternar status da tarefa
        async function toggleTaskStatus(taskId, currentStatus) {
            const newStatus = currentStatus === 'concluida' ? 'pendente' : 'concluida';
            
            try {
                const response = await fetch(`/api/tasks/${taskId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    refreshData();
                    const message = newStatus === 'concluida' ? 'Tarefa marcada como concluída!' : 'Tarefa marcada como pendente!';
                    showSuccess(message);
                } else {
                    showError('Erro ao atualizar status: ' + result.message);
                }
            } catch (error) {
                showError('Erro de conexão: ' + error.message);
            }
        }

        // Função para excluir tarefa
        function deleteTask(taskId) {
            fetch(`/api/tasks/${taskId}`)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        taskToDelete = taskId;
                        document.getElementById('deleteTaskTitle').textContent = result.task.title;
                        document.getElementById('deleteModal').style.display = 'block';
                    }
                })
                .catch(error => {
                    showError('Erro ao carregar tarefa: ' + error.message);
                });
        }

        // Função para confirmar exclusão
        async function confirmDelete() {
            if (!taskToDelete) return;
            
            try {
                const response = await fetch(`/api/tasks/${taskToDelete}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    closeDeleteModal();
                    refreshData();
                    showSuccess('Tarefa excluída com sucesso!');
                } else {
                    showError('Erro ao excluir tarefa: ' + result.message);
                }
            } catch (error) {
                showError('Erro de conexão: ' + error.message);
            }
        }

        // Funções para fechar modais
        function closeEditModal() {
            document.getElementById('editTaskModal').style.display = 'none';
            document.getElementById('editTaskForm').reset();
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            taskToDelete = null;
        }

        // Criar nova tarefa
        async function createTask(event) {
            event.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const priority = document.getElementById('taskPriority').value;
            const dueDate = document.getElementById('taskDueDate').value;
            
            const taskData = {
                title,
                description,
                priority,
                due_date: dueDate ? new Date(dueDate).toISOString() : null,
                user_id: '149aaad6-8b7e-493b-8a43-93a06ad5836a'
            };
            
            try {
                const response = await fetch('/api/tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(taskData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    closeModal();
                    refreshData();
                    showSuccess('Tarefa criada com sucesso!');
                } else {
                    showError('Erro ao criar tarefa: ' + result.message);
                }
            } catch (error) {
                showError('Erro de conexão: ' + error.message);
            }
        }

        function showSuccess(message) {
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <i class="fas fa-check-circle"></i> ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Fechar modal clicando fora
        window.onclick = function(event) {
            const taskModal = document.getElementById('taskModal');
            const editModal = document.getElementById('editTaskModal');
            const deleteModal = document.getElementById('deleteModal');
            
            if (event.target === taskModal) {
                closeModal();
            } else if (event.target === editModal) {
                closeEditModal();
            } else if (event.target === deleteModal) {
                closeDeleteModal();
            }
        }

        // Carregar dados ao inicializar
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>